<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DreamHome Maas – Kostenübersicht</title>

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;
  background:#f3f4f6;
  color:#111827;
}
header{
  background:#1f2937;
  color:#fff;
  padding:20px;
  text-align:center;
}
main{
  max-width:1000px;
  margin:20px auto;
  padding:0 12px;
}
button{
  background:#2563eb;
  color:#fff;
  border:none;
  padding:10px 14px;
  border-radius:6px;
  cursor:pointer;
}
button:disabled{opacity:.6}
table{
  width:100%;
  border-collapse:collapse;
  background:#fff;
}
th,td{
  padding:10px;
  border-bottom:1px solid #e5e7eb;
  text-align:left;
}
th{background:#f9fafb}
input[type="text"],input[type="number"]{
  width:100%;
  padding:8px;
}
.total{
  margin-top:16px;
  font-size:18px;
  text-align:right;
}
@media(max-width:700px){
  table,thead,tbody,tr,th,td{display:block}
  thead{display:none}
  tr{
    margin-bottom:12px;
    border:1px solid #e5e7eb;
    border-radius:8px;
    padding:10px;
  }
  td{border:none}
}
</style>
</head>

<body>
<header>
  <h1>DreamHome Maas</h1>
  <p>Funktionierende Kostenübersicht</p>
</header>

<main>
  <button id="addRow">+ Neue Zeile</button>

  <table>
    <thead>
      <tr>
        <th>Bezeichnung</th>
        <th>Betrag (€)</th>
        <th>Dokument</th>
        <th>Aktion</th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>

  <div class="total" id="total">Gesamtausgaben: 0,00 €</div>
</main>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

const firebaseConfig = {
  apiKey: "AIzaSyChZANVbhTA_ZzLyOvygJZL9ikpoGamAyo",
  authDomain: "dreamhomemaas.firebaseapp.com",
  projectId: "dreamhomemaas",
  storageBucket: "dreamhomemaas.appspot.com",
  messagingSenderId: "683852893002",
  appId: "1:683852893002:web:afe0b2c12"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const storage = getStorage(app);
const expensesRef = collection(db,"expenses");

const tbody = document.getElementById("tableBody");
const totalEl = document.getElementById("total");

document.getElementById("addRow").onclick = () => {
  const tr = document.createElement("tr");
  tr.innerHTML = `
    <td><input type="text" placeholder="z. B. Notar"></td>
    <td><input type="number" step="0.01" placeholder="0,00"></td>
    <td><input type="file"></td>
    <td><button>Speichern</button></td>
  `;
  tr.querySelector("button").onclick = () => saveRow(tr);
  tbody.prepend(tr);
};

async function saveRow(tr){
  const title = tr.children[0].querySelector("input").value.trim();
  const amount = parseFloat(tr.children[1].querySelector("input").value);
  const file = tr.children[2].querySelector("input").files[0];

  if(!title || isNaN(amount)){
    alert("Bitte Bezeichnung und Betrag eingeben");
    return;
  }

  let fileUrl = null;
  if(file){
    const storageRef = ref(storage,`documents/${Date.now()}_${file.name}`);
    await uploadBytes(storageRef,file);
    fileUrl = await getDownloadURL(storageRef);
  }

  await addDoc(expensesRef,{ title, amount, fileUrl });
}

onSnapshot(expensesRef,(snap)=>{
  tbody.innerHTML="";
  let sum = 0;
  snap.forEach(doc=>{
    const d = doc.data();
    sum += d.amount;
    tbody.innerHTML += `
      <tr>
        <td>${d.title}</td>
        <td>${d.amount.toFixed(2).replace(".",",")}</td>
        <td>${d.fileUrl ? `<a href="${d.fileUrl}" target="_blank">Öffnen</a>` : "-"}</td>
        <td>✔</td>
      </tr>
    `;
  });
  totalEl.textContent = "Gesamtausgaben: " + sum.toFixed(2).replace(".",",") + " €";
});
</script>

</body>
</html>
